package com.bpaquet.elasticsearch.river.zeromq;

import java.io.IOException;
import java.net.ConnectException;
import java.net.Socket;

import org.elasticsearch.common.xcontent.XContentBuilder;
import org.elasticsearch.common.xcontent.XContentFactory;
import org.junit.Test;

public class ZeroMQLogstashRiverFailedOpenTest extends ZeroMQLogstashRiverRunnerTest{

	@Override
	protected XContentBuilder river() throws IOException {
		return XContentFactory.jsonBuilder()
				.startObject()
				.field("type", "zeromq-logstash")
				.startObject("zeromq-logstash")
				.field("address", "tcp://127.0.0.1:79")
				.endObject()
				.endObject();
	}
	
	@Test(expected=ConnectException.class)
	public void failedStartup() throws Exception {
		Socket s = new Socket("127.0.0.1", 79);
		s.close();
	}

}
